<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:insert th:replace="~{fragments :: metadata}"></th:insert>
    <meta name="_csrf" th:content="${_csrf?.token}">
    <meta name="_csrf_header" th:content="${_csrf?.headerName}">

    <title>Patruller</title>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var path = /*[[@{/}]]*/ '';
        /*]]>*/
    </script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        function confirmDelete(formId) {
            if (confirm("Vill du ta bort patrullen?")) {
                document.getElementById(formId).submit();
            }
            return false;
        }
        /*]]>*/
    </script>
    <script th:src="@{/js/patrol_admin.js}" defer></script>
</head>
<body>
<div class="nav-box">
    <h1>Patruller</h1>
    <a th:href="@{/admin/patrol/new}">Lägg till ny patrull</a> |
    <a th:href="@{/admin}">Tillbaka</a>
</div>

<!-- Include messages -->
<div th:insert="~{fragments :: messages(${errormsg}, ${confirmmsg})}"></div>

<div class="notepad">
    <!-- Filters -->
    <form method="get" th:action="@{/admin/patrol}" class="filter-form">
        <label for="trackFilter">Klass:</label>
        <select name="id" id="trackFilter">
            <option value="">Alla</option>
            <option th:each="track : ${tracks}"
                    th:value="${track.id}"
                    th:text="${track.name}"
                    th:selected="${track.id == selectedId}">
            </option>
        </select>

        <label for="statusFilter">Status:</label>
        <select name="status" id="statusFilter">
            <option value="">Alla</option>
            <option th:each="s : ${T(se.scouttavling.gokapp.patrol.Status).values()}"
                    th:value="${s}"
                    th:text="${s}"
                    th:selected="${s == selectedStatus}">
            </option>
        </select>

        <button type="submit" class="btn btn-primary btn-sm">Filtrera</button>
    </form>

    <!-- Patrol table -->
    <table class="table table-striped">
        <thead>
        <tr>
            <th><a th:href="@{/admin/patrol(sort='patrolName')}">Patrullnamn</a></th>
            <th><a th:href="@{/admin/patrol(sort='track')}">Klass</a></th>
            <th><a th:href="@{/admin/patrol(sort='troop')}">Scoutkår</a></th>
            <th><a th:href="@{/admin/patrol(sort='status')}">Status</a></th>
            <th><a th:href="@{/admin/patrol(sort='totalScore')}">Poäng</a></th>
            <th>Betald</th>
            <th>Åtgärder</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="patrol,iterStat : ${patrols}">
            <td>
                <a th:href="@{/admin/patrol/{id}(id=${patrol.patrolId})}"
                   th:text="${patrol.patrolName}">Patrullnamn</a>
            </td>
            <td th:text="${patrol.track.name}"></td>
            <td th:text="${patrol.troop}"></td>
            <td th:text="${patrol.status}"></td>
            <td th:text="${patrol.totalScore}"></td>
            <td>
                <span class="paid-action"
                      th:data-id="${patrol.patrolId}"
                      th:data-status="${patrol.paid ? 'paid' : 'notpaid'}"
                      th:utext="${patrol.paid ? 'Ja' : 'Nej'}">
                </span>
            </td>

            <td>
                <!-- Delete form -->
                <form th:id="'deleteForm-' + ${iterStat.index}"
                      th:action="@{/admin/patrol/{id}/delete(id=${patrol.patrolId})}"
                      method="post" style="display:inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <a href="#"
                       class="del"
                       th:onclick="'return confirmDelete(\'deleteForm-' + ${iterStat.index} + '\');'">
                        <img th:src="@{/css/delete.png}" alt="Radera"/>
                    </a>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>
