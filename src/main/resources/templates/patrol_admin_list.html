<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:insert th:replace="~{fragments :: metadata}"></th:insert>
    <meta name="_csrf" th:content="${_csrf?.token}">
    <meta name="_csrf_header" th:content="${_csrf?.headerName}">

    <title>Patruller</title>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var path = /*[[@{/}]]*/ '';
        /*]]>*/
    </script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        function confirmDelete(formId) {
            if (confirm("Vill du ta bort patrullen?")) {
                document.getElementById(formId).submit();
            }
            return false;
        }
        /*]]>*/
    </script>
    <script th:src="@{/js/patrol_admin.js}" defer></script>
</head>
<body>
<div class="nav-box">
    <h1>Patruller</h1>
    <a th:href="@{/admin/patrol/new}">Lägg till ny patrull</a> |
    <a th:href="@{/admin}">Tillbaka</a>
</div>

<!-- Include messages -->
<div th:insert="~{fragments :: messages(${errormsg}, ${confirmmsg})}"></div>

<div class="notepad">
    <!-- Patrol table -->
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Patrullnamn <a th:href="@{/admin/patrol(sort='patrolName', dir=${dir == 'asc' ? 'desc' : 'asc'})}"><img th:src="@{/css/arrow-down.png}" alt="sort"></a></th>
            <th>Klass <a th:href="@{/admin/patrol(sort='track.name', dir=${dir == 'asc' ? 'desc' : 'asc'})}"><img th:src="@{/css/arrow-down.png}" alt="sort"></a></th>
            <th>Kår <a th:href="@{/admin/patrol(sort='troop', dir=${dir == 'asc' ? 'desc' : 'asc'})}"><img th:src="@{/css/arrow-down.png}" alt="sort"></a></th>
            <th>Startkontroll <a th:href="@{/admin/patrol(sort='startStation', dir=${dir == 'asc' ? 'desc' : 'asc'})}"><img th:src="@{/css/arrow-down.png}" alt="sort"></a></th>
            <th>Status <a th:href="@{/admin/patrol(sort='status', dir=${dir == 'asc' ? 'desc' : 'asc'})}"><img th:src="@{/css/arrow-down.png}" alt="sort"></a></th>
            <th>Betald</th>
            <th>Åtgärder</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="patrol,iterStat : ${patrols}">
            <td>
                <a th:href="@{/admin/patrol/{id}(id=${patrol.patrolId})}"
                   th:text="${patrol.patrolName}">Patrullnamn</a>
            </td>
            <td th:text="${patrol.track.name}"></td>
            <td th:text="${patrol.troop}"></td>
            <td th:text="${patrol?.startStation?.stationName}"></td>
            <td><img class="patrol" th:src="@{|/css/${patrol.status != null ? patrol.status : 'REGISTERED'}.png|}"/></td>
            <td>
                <span class="paid-action"
                      th:data-id="${patrol.patrolId}"
                      th:data-status="${patrol.paid ? 'paid' : 'notpaid'}"
                      th:utext="${patrol.paid ? 'Ja' : 'Nej'}">
                </span>
            </td>

            <td>
                <!-- Delete form -->
                <form th:id="'deleteForm-' + ${iterStat.index}"
                      th:action="@{/admin/patrol/{id}/delete(id=${patrol.patrolId})}"
                      method="post" style="display:inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <a href="#"
                       class="del"
                       th:onclick="'return confirmDelete(\'deleteForm-' + ${iterStat.index} + '\');'">
                        <img th:src="@{/css/delete.png}" alt="Radera"/>
                    </a>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>
