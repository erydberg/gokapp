<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:insert th:replace="~{fragments :: metadata}"></th:insert>
    <title>Patruller</title>
    <script th:inline="javascript">
        /*<![CDATA[*/
            // Base context path for URLs
            var path = /*[[@{/}]]*/ '';

            var csrfToken = /*[[${_csrf.token}]]*/ '';
            var csrfHeader = /*[[${_csrf.headerName}]]*/ '';
        /*]]>*/
    </script>
    <script th:inline="javascript">
        console.log("JS is running");
    </script>
    <script th:src="@{/js/patrol_admin.js}" defer></script>
</head>
<body>
<div class="nav-box">
    <h1>Patruller</h1>
    <a th:href="@{/admin/patrol/new}">Lägg till ny patrull</a> |
    <a th:href="@{/admin}">Tillbaka</a>
</div>

<!-- Include messages -->
<div th:insert="~{fragments :: messages(${errormsg}, ${confirmmsg})}"></div>

<div class="notepad">
    <!-- Filters -->
    <form method="get" th:action="@{/admin/patrol}" class="filter-form">
        <label for="trackFilter">Klass:</label>
        <select name="id" id="trackFilter">
            <option value="">Alla</option>
            <option th:each="track : ${tracks}"
                    th:value="${track.id}"
                    th:text="${track.name}"
                    th:selected="${track.id == selectedId}">
            </option>
        </select>

        <label for="statusFilter">Status:</label>
        <select name="status" id="statusFilter">
            <option value="">Alla</option>
            <option th:each="s : ${T(se.scouttavling.gokapp.patrol.Status).values()}"
                    th:value="${s}"
                    th:text="${s}"
                    th:selected="${s == selectedStatus}">
            </option>
        </select>

        <button type="submit" class="btn btn-primary btn-sm">Filtrera</button>
    </form>

    <!-- Patrol table -->
    <table class="table table-striped">
        <thead>
        <tr>
            <th><a th:href="@{/patrol(sort='patrolName')}">Patrullnamn</a></th>
            <th><a th:href="@{/patrol(sort='track')}">Klass</a></th>
            <th><a th:href="@{/patrol(sort='troop')}">Scoutkår</a></th>
            <th><a th:href="@{/patrol(sort='status')}">Status</a></th>
            <th><a th:href="@{/patrol(sort='totalScore')}">Poäng</a></th>
            <th>Betald</th>
            <th>Åtgärder</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="patrol : ${patrols}">
            <td>
              <a th:href="@{/admin/patrol/{id}(id=${patrol.patrolId})}"
               th:text="${patrol.patrolName}">Patrullnamn</a>
            </td>
            <td th:text="${patrol.track.name}"></td>
            <td th:text="${patrol.troop}"></td>
            <td th:text="${patrol.status}"></td>
            <td th:text="${patrol.totalScore}"></td>
            <td>
                <span class="paid-action"
                    th:data-id="${patrol.patrolId}"
                    th:data-status="${patrol.paid ? 'paid' : 'notpaid'}"
                    th:utext="${patrol.paid ? 'Ja' : 'Nej'}">
                </span>
            </td>

            <td>
                <a th:href="@{/patrol/view/{id}(id=${patrol.patrolId})}" class="btn btn-info btn-sm">Visa</a>
                <a th:href="@{/admin/patrol/{id}(id=${patrol.patrolId})}"
                   class="btn btn-warning btn-sm">Redigera</a>


                <form th:action="@{/admin/patrol/{id}/delete(id=${patrol.patrolId})}"
                      method="post" style="display:inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <a href="#"
                       th:onclick="'return confirmDelete(this.form);'">
                        <img th:src="@{/css/delete.png}" alt="Radera"/>
                    </a>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>
